<!-- templates/settings.html -->
{% extends "base.html" %}

{% block title %}Family Planner Settings{% endblock %}

{% block content %}
<h1>Family Planner Settings</h1>

<h2>Family Members</h2>
<ul>
    {% for member in family_members %}
    <li>
        {{ member.name }}
        <form action="{{ url_for('remove_family_member', member_id=member.id) }}" method="post" style="display: inline;">
            <button type="submit" onclick="return confirm('Are you sure you want to remove this family member?');">Remove</button>
        </form>
    </li>
    {% endfor %}
</ul>

<h3>Add New Family Member</h3>
<form action="{{ url_for('add_family_member') }}" method="post">
    <input type="text" name="name" required placeholder="Enter name">
    <button type="submit">Add Family Member</button>
</form>

<h3>Import/Export CSV</h3>
<form id="csv-form" action="{{ url_for('import_csv') }}" method="post" enctype="multipart/form-data">
    <select id="family-member-select" name="family_member_id" required>
        <option value="">Select Family Member</option>
        {% for member in family_members %}
        <option value="{{ member.id }}">{{ member.name }}</option>
        {% endfor %}
    </select>
    <input type="file" name="file" accept=".csv" required>
    <button type="submit">Import CSV</button>
    <button type="button" id="export-csv">Export CSV</button>
</form>

<a href="{{ url_for('index') }}">Back to Planner</a>

<script>
    document.getElementById('csv-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        fetch('{{ url_for("import_csv") }}', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('CSV imported successfully!');
            } else {
                alert('Error importing CSV: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while importing the CSV.');
        });
    });

    document.getElementById('export-csv').addEventListener('click', function() {
        const familyMemberId = document.getElementById('family-member-select').value;
        if (!familyMemberId) {
            alert('Please select a family member to export data.');
            return;
        }
        
        window.location.href = `{{ url_for('export_csv') }}?family_member_id=${familyMemberId}`;
    });
</script>
{% endblock %}